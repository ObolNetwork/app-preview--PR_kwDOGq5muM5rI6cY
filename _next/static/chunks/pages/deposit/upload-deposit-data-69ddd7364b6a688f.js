(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6875],{21245:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/deposit/upload-deposit-data",function(){return o(86076)}])},50134:function(e,t,o){"use strict";o.d(t,{u:function(){return beaconChainCheck}});var r=o(87066);let beaconChainCheck=async e=>{let{data:t}=await r.Z.get(e);return t}},86076:function(e,t,o){"use strict";o.a(e,async function(e,r){try{o.r(t);var a=o(85893),i=o(67294),n=o(32512),s=o(61472),l=o(34695),u=o(99492),c=o(24967),d=o(98682),p=o(95954),f=o(11163),h=o(86105),g=e([p]);p=(g.then?(await g)():g)[0];let UploadDepositData=()=>{let[e,t]=(0,i.useState)(!1),[o,r]=(0,i.useState)(""),[g,y]=(0,i.useState)(""),[b,m]=(0,i.useState)(!1),x=(0,d.o)(e=>e.setDepositData),_=(0,f.useRouter)(),v=(0,d.o)((0,i.useCallback)(e=>e.completeDepositStep,[])),k=(0,d.o)(e=>e.enableDepositStep),handleContinue=()=>{v("upload-deposit-data");let e=k("connect-wallet");_.push(e.href)},{isDragAccept:w,getRootProps:D,getInputProps:j}=(0,n.u)({accept:"application/json",noClick:e,onDrop:(e,o)=>{if(r(""),null==o?void 0:o.length){r("Upload a valid json file.");return}if(1===e.length){m(!0);let o=new FileReader;o.onload=async o=>{if(o.target)try{if(o.target.result&&"string"==typeof o.target.result){let a=(0,p.RJ)(JSON.parse(o.target.result));if(!a){t(!1),r("This is not a valid ".concat(h.rk," file"));return}try{let o=await (0,p.sB)(a),r=o.data.flatMap(e=>e.publickey.substring(2));y(e[0].name),x(a.map(e=>r.includes(e.pubkey)?{...e,transactionStatus:l.LN.DEPOSITED,depositStatus:l.Er.ALREADY_DEPOSITED}:{...e,transactionStatus:l.LN.READY,depositStatus:l.Er.READY_FOR_DEPOSIT})),m(!1),t(!0)}catch(e){t(!1),m(!1),r("Beaconchain is down. Please try again later.")}}}catch(o){let{message:e}=o;m(!1),t(!1),r(e)}},o.readAsText(e[0])}else m(!1),r("Activate only one deposit file at a time")}}),E=(0,i.useCallback)(()=>{x([]),r(""),t(!1)},[x]);return(0,a.jsxs)(s.kC,{direction:"column",css:{gap:"$2xl"},children:[(0,a.jsx)(s.xv,{variant:"h3",children:"Upload Deposit Data "}),(0,a.jsxs)(s.W2,{className:"enr-section",alignItems:"start",css:{gap:"$lg"},children:[(0,a.jsxs)(s.xv,{variant:"body",children:["Upload the ",(0,a.jsx)(s.xv,{variant:"pill",color:"create",children:h.rk})," file you generated during the ceremony. It is located in the ",(0,a.jsx)(s.xv,{variant:"pill",color:"create",children:".charon/"})," subfolder."]}),(0,a.jsxs)(s.xv,{variant:"body",children:["Note: if you can't find ",(0,a.jsx)(s.xv,{variant:"pill",color:"create",children:".charon"}),", search for how to show hidden folder in your OS."]}),(0,a.jsx)(s.kC,{css:{bc:"$bg03",p:"$2xl",boxSizing:"border-box"},children:(0,a.jsxs)(s.kC,{css:{flexDirection:"column",alignItems:"center"},...D(),children:[(0,a.jsx)("input",{...j()}),(0,a.jsx)(u.w,{isDragAccept:w,isFileAccepted:e}),(0,a.jsx)(s.xv,{css:{mt:"$lg",color:"$body",fontWeight:"$medium",fontSize:"$4",lineHeight:"24px"},children:e&&!o?(0,a.jsxs)(s.kC,{css:{gap:"$sm"},children:[g,(0,a.jsx)(s.xu,{onClick:E,children:(0,a.jsx)(s.Tw,{css:{color:"$obolGreen"}})})]}):o?(0,a.jsx)(s.xv,{variant:"metadata",color:"test",children:o}):b?(0,a.jsx)(c.Q9,{children:"Processing file"}):"Upload a valid json file."})]})}),(0,a.jsxs)(s.kC,{children:[(0,a.jsx)(s.zx,{css:{width:"25%",backgroundColor:"$bg03",color:"$body",marginRight:"$sm"},onClick:()=>{_.push("/deposit/advisories")},children:"Back"}),(0,a.jsx)(s.zx,{fullWidth:!0,disabled:!e||!!o,onClick:()=>{handleContinue()},children:"Continue"})]})]})]})};t.default=UploadDepositData,UploadDepositData.layout="DepositProgressTrackerLayout",r()}catch(e){r(e)}})},95954:function(e,t,o){"use strict";o.a(e,async function(e,r){try{o.d(t,{RJ:function(){return mapDepositData},sB:function(){return getExistingDepositsForPubKeys}});var a=o(86105),i=o(80444),n=o(50134),s=e([i]);i=(s.then?(await s)():s)[0];let validateFieldFormatting=e=>!(!e.pubkey||!e.withdrawal_credentials||!e.amount||!e.signature||!e.deposit_message_root||!e.deposit_data_root||!e.fork_version||!e.network_name||!e.deposit_cli_version||"string"!=typeof e.pubkey||"string"!=typeof e.withdrawal_credentials||"number"!=typeof e.amount||"string"!=typeof e.signature||"string"!=typeof e.deposit_message_root||"string"!=typeof e.deposit_data_root||"string"!=typeof e.fork_version||"string"!=typeof e.network_name||"string"!=typeof e.deposit_cli_version||96!==e.pubkey.length||64!==e.withdrawal_credentials.length||192!==e.signature.length||64!==e.deposit_message_root.length||64!==e.deposit_data_root.length||8!==e.fork_version.length||0>e.deposit_cli_version.localeCompare(a.Uz,void 0,{numeric:!0,sensitivity:"base"}))&&!(e.amount<a.do)&&!(e.amount>32*a.jK)&&"0x".concat(e.fork_version)===a.se,mapDepositData=e=>{if(!Array.isArray(e))return!1;let t=e.map(e=>{if(!isDepositKey(e))throw Error("This isn't a valid deposit_data JSON file. Try again.");if(!(0,i.uM)(e))throw Error("Deposit Signature can't be verified.");if(!(0,i.zJ)(e))throw Error("Deposit Root can't be verified.");return e});return t},isDepositKey=e=>validateFieldFormatting(e),getExistingDepositsForPubKeys=async e=>{let t=e.flatMap(e=>e.pubkey),o=[];for(let e=0;e<t.length;e+=50)o.push(t.slice(e,e+50));let r=[],i=[];for(let e of o){let t="".concat(a.q2,"/api/v1/validator/").concat(e.join(","),"/deposits");try{let{data:e,status:o}=await (0,n.u)(t);if(e&&"OK"===o)r.push(...e),i.push(o);else throw Error("Beaconchain API error for chunk")}catch(e){throw Error("Error fetching data for chunk:",e)}}console.log("status",i);let s=i.every(e=>"OK"===e)?"OK":"ERROR";return{data:r,status:s}};r()}catch(e){r(e)}})},80444:function(e,t,o){"use strict";o.a(e,async function(e,r){try{o.d(t,{uM:function(){return verifySignature},zJ:function(){return verifyDepositRoots}});var a=o(38759),i=o(25874),n=o(86105),s=o(34695),l=o(48764).Buffer,u=e([a]);a=(u.then?(await u)():u)[0];let verifyDepositRoots=e=>{let t=(0,s.kA)(),o=t.defaultValue();o.pubkey=(0,i.Wu)(e.pubkey),o.withdrawalCredentials=(0,i.Wu)(e.withdrawal_credentials),o.amount=e.amount;let r=(0,s.Jb)(),a=r.defaultValue();return a.pubkey=(0,i.Wu)(e.pubkey),a.withdrawalCredentials=(0,i.Wu)(e.withdrawal_credentials),a.amount=e.amount,a.signature=(0,i.Wu)(e.signature),l.from(t.hashTreeRoot(o).buffer).toString("hex")===e.deposit_message_root&&l.from(r.hashTreeRoot(a).buffer).toString("hex")===e.deposit_data_root},bufferHex=e=>l.from(e,"hex"),computeForkDataRoot=(e,t)=>{let o=(0,s.ME)(),r=o.defaultValue();return r.currentVersion=e,r.genesisValidatorsRoot=t,l.from(o.hashTreeRoot(r).buffer)},computeDomain=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bufferHex(n.se.substring(2,n.se.length)),o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bufferHex(n.qH),r=computeForkDataRoot(t,o),a=new Uint8Array(32);return a.set(e),a.set(r.subarray(0,28),4),a},computeSigningRoot=(e,t)=>{let o=(0,s.bX)(),r=o.defaultValue();return r.objectRoot=e,r.domain=t,l.from(o.hashTreeRoot(r).buffer)},verifySignature=e=>{let t=bufferHex(e.pubkey),o=bufferHex(e.signature),r=bufferHex(e.deposit_message_root),i=computeDomain(bufferHex(n.ms)),s=computeSigningRoot(r,i);return a.ZP.verify(t,s,o)};r()}catch(e){r(e)}})}},function(e){e.O(0,[9240,7544,9774,2888,179],function(){return e(e.s=21245)}),_N_E=e.O()}]);